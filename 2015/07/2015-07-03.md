## HTML5

### [How fast are web workers?](https://hacks.mozilla.org/2015/07/how-fast-are-web-workers/)

[Benchmark](https://github.com/gmarty/web-workers-benchmark)

#### Workers

* Web workers
  * Can only talk to the main thread
* Shared workers
  * Can talk to all threads **under the same origin**
  * Including threads in other tabs/iframes/other shared workers
  * Lifetime is controlled by the browser
  * You can use [BroadcastChannel](https://hacks.mozilla.org/2015/02/broadcastchannel-api-in-firefox-38/) to broadcast messages among them
* Service workers
  * Can serve as proxy(combined with caching you've got offline apps)

#### Cost of instantiation

* 40ms on Firefox OS with Flame
* Note: 60fps => 16.66ms per frame, so any JS code running longer than that will introduce jankiness
* Solution: pool. **Reuse your workers**.
* 1ms for creating broadcast channel

#### Message lantency

* 0~1ms to post a message, 1~2ms to broadcast a message

#### Size of message

* Transferring message
  * The sender can no longer use it once cent
  * Almost instantaneous
  * Only ArrayBuffer can be transferred
* 45kb/ms for `postMessage`, 6kb/ms for broadcasting
* To fit the frame rate, keep the data under 350MB for `postMessage` and under 50MB when using broadcast channels.
* Objects will take longer to post. Try serialize it into a binary format like [`Protocol Buffer`](https://developers.google.com/protocol-buffers/)